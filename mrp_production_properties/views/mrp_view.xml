<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="mrp_production_form_view" model="ir.ui.view">
            <field name="name">mrp.production.form</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.mrp_production_form_view"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='availability']" position="after">
                    <field name="property_ids" widget="many2many_tags" groups="product.group_mrp_properties"/>
                </xpath>
            </field>
        </record>

        <!-- SALE -->
        <record id="view_order_form_inherit_sale_mrp" model="ir.ui.view">
            <field name="name">sale.order.form.sale.stock.mrp</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='order_line']/tree//field[@name='tax_id']" position="after">
                    <field name="property_ids" widget="many2many_tags" groups="sale.group_mrp_properties"/>
                </xpath>
            </field>
        </record>

        <!-- MRP BOM mrp_bom_form_view -->

        <record id="mrp_bom_property_form_view" model="ir.ui.view">
            <field name="name">mrp.bom.property.form.view</field>
            <field name="model">mrp.bom</field>
            <field name="inherit_id" ref="mrp.mrp_bom_form_view"/>
            <field name="arch" type="xml">
             <notebook position="inside">
                 <page string="Property" groups="product.group_mrp_properties">
                    <field name="property_ids" widget="many2many_tags"/>
                </page>
            </notebook>
            </field>
        </record>


        <!-- procurement -->
        <record id="view_procurement_form_inherit" model="ir.ui.view">
            <field name="name">procurement.order.form.inherit</field>
            <field name="model">procurement.order</field>
            <field name="inherit_id" ref="procurement.procurement_form_view"/>
            <field name="arch" type="xml">
            <data>
                <field name="origin" position="before">
                    <field name="bom_id" domain="[('product_id','=',product_id)]"/>
                    <field name="production_id" attrs="{'invisible': [('production_id','=',False)]}"/>
                </field>
                <field name="origin" position="after">
                    <field name="property_ids" widget="many2many_tags" groups="product.group_mrp_properties"/>
                </field>
               </data>
            </field>
        </record>

        <record id="mrp_property_group_form_view" model="ir.ui.view">
            <field name="name">mrp.property.group.form</field>
            <field name="model">mrp.property.group</field>
            <field name="arch" type="xml">
                <form string="Properties categories">
                    <group>
                        <field name="name"/>
                    </group>
                    <separator string="Description"/>
                    <field name="description" nolabel="1"/>
                </form>
            </field>
        </record>

        <record id="mrp_property_group_action" model="ir.actions.act_window">
            <field name="name">Property Groups</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.property.group</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a group of properties.
              </p><p>
                Define specific property groups that can be assigned to your
                bill of materials and sales orders. Properties allows Odoo
                to automatically select the right bill of materials according
                to properties selected in the sales order by salesperson.
              </p><p>
                For instance, in the property group "Warranty", you an have
                two properties: 1 year warranty, 3 years warranty. Depending
                on the propoerties selected in the sales order, Odoo will
                schedule a production using the matching bill of materials.
              </p>
            </field>
        </record>

        <menuitem id="menu_mrp_property_group_action"
            action="mrp_property_group_action"
            parent="mrp.menu_mrp_configuration"
            groups="base.group_no_one,product.group_mrp_properties"
            sequence="35"/>

        <record id="mrp_property_tree_view" model="ir.ui.view">
            <field name="name">mrp.property.tree</field>
            <field name="model">mrp.property</field>
            <field name="arch" type="xml">
                <tree string="Properties">
                    <field name="name"/>
                    <field name="composition"/>
                    <field name="group_id"/>
                </tree>
            </field>
        </record>

        <record id="mrp_property_form_view" model="ir.ui.view">
            <field name="name">mrp.property.form</field>
            <field name="model">mrp.property</field>
            <field name="arch" type="xml">
                <form string="Properties">
                    <group col="4">
                        <field colspan="4" name="name"/>
                        <field name="group_id"/>
                        <field name="composition"/>
                    </group>
                    <separator string="Description"/>
                    <field name="description" nolabel="1"/>
                </form>
            </field>
        </record>

        <record id="view_mrp_property_search" model="ir.ui.view">
            <field name="name">mrp.property.search</field>
            <field name="model">mrp.property</field>
            <field name="arch" type="xml">
                <search string="Search">
                    <field name="name" string="Name"/>
                    <field name="composition"/>
                    <field name="group_id" />
                    <group expand="0" string="Group By">
                        <filter string="Property Group" domain="[]" context="{'group_by':'group_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="mrp_property_action" model="ir.actions.act_window">
            <field name="name">Properties</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.property</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_mrp_property_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a new property.
              </p><p>
                The Properties in Odoo are used to select the right bill of
                materials for manufacturing a product when you have different
                ways of building the same product.  You can assign several
                properties to each bill of materials.  When a salesperson
                creates a sales order, they can relate it to several properties
                and Odoo will automatically select the BoM to use according
                the needs.
              </p>
            </field>
        </record>

        <menuitem id="menu_mrp_property_action"
            action="mrp_property_action"
            groups="product.group_mrp_properties"
            parent="mrp.menu_mrp_configuration"
            sequence="30"/>
    </data>
</odoo>